{% extends 'dashboard.html' %}

{% block content %}
<div class="container py-4 bg-white rounded shadow">
    <h2 class="h3 font-weight-bold text-dark mb-4">Upload Inventory via CSV</h2>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }} rounded p-3 mb-3 shadow-sm">
                        {% if category == 'success' %}<i class="fas fa-check-circle"></i>
                        {% elif category == 'danger' %}<i class="fas fa-times-circle"></i>
                        {% elif category == 'warning' %}<i class="fas fa-exclamation-triangle"></i>
                        {% elif category == 'info' %}<i class="fas fa-info-circle"></i>
                        {% endif %}
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="card p-4">
        <h5 class="card-title font-weight-semibold">CSV File Upload</h5>
        <p class="card-text text-muted">
            Upload a CSV file to add or update your inventory. The file must have the following columns: 
            <br><code>product_name, category, purchase_price, current_stock, batch_number, number_of_tabs, item_type, expiry_date, is_fixed_price, fixed_sale_price, is_active</code>
        </p>
        <p class="card-text text-danger font-weight-bold">
            Note: The `is_fixed_price` and `is_active` columns must be "True" or "False".
        </p>
        
        <form action="{{ url_for('upload_current_inventory_csv') }}" method="post" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group mt-3">
                <label for="csvFile">Choose CSV File</label>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="csvFile" name="csv_file" accept=".csv" required>
                    <label class="custom-file-label" for="csvFile">Select file...</label>
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3">
                <i class="fas fa-upload mr-2"></i> Upload Inventory
            </button>
        </form>
    </div>
</div>

<script>
// JavaScript to display the selected file name in the custom file input label
document.getElementById('csvFile').addEventListener('change', function(e) {
    var fileName = e.target.files[0].name;
    var nextSibling = e.target.nextElementSibling;
    nextSibling.innerText = fileName;
});
</script>
{% endblock %}